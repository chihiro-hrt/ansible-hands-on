[↑目次に戻る](/README.md)
<br>


# 演習5.2　定期監視と障害発生時の一次情報取得を自動化

演習5.2はALAXALA装置に対しての疎通確認をスケジューリングし、NW障害やオペレーションミスで疎通確認が失敗した場合の一次情報取得をワークフロー実行する演習を行います。

## 目次
本演習では以下を行います。  
- STEP1.<code>ping</code>モジュールを利用したALAXALA装置への疎通確認用のPlaybookを作成する
- STEP2.疎通確認から障害時の一次情報取得までの作業をワークフロー化する
- STEP3.手動でオペレーションミスを起こす
- STEP4.ワークフローを実行し、疎通障害の検出とコンソール（SmartCS）経由で一次情報取得をする
- STEP5.コンソール（SmartCS）経由で設定を復旧させる

## 演習構成図

>変更する必要あり

<br>
<br>

### STEP1.<code>ping</code>モジュールを利用したALAXALA装置への疎通確認用のPlaybookを作成する

まずは、演習5.2で使用するPlaybookを作成し、Ansible Towerから実行するための<code>/var/lib/awx/projects/exercise_5</code>ディレクトリを作成します。
```
$ mkdir /var/lib/awx/projects/exercise_5
```

STEP1では、ALAXALA装置に対して<code>ping</code>モジュールを利用して疎通確認を行うPlaybookを作成します。
疎通確認を行うPlaybook例を以下に記載します。

■(ping_monitoring.yml)
```yaml
---
- name: monitoring ax connectivity
  hosts: ax
  gather_facts: no

  vars:
  - ansible_connection: network_cli
  - ansible_network_os: ax

  tasks:
  - name: ping monitoring
    ping:
```

■Playbook内容の説明
<code>ping</code>モジュールを利用して、ALAXALA装置への疎通確認を行います。
コネクションプラグインとして<code>network_cli</code>を利用して、SSHでALAXALA装置に接続できるかどうかを確認します。
- ping:
<code>hosts</code>で指定した対象装置に対して疎通確認を行います。
疎通確認方法は、<code>ansible_connection</code>にて指定するコネクションプラグインに依存します。
| コネクションプラグイン | 疎通確認方法 |
| network_cli | SSHで対象装置に接続できるかどうか |
| ssh / paramiko | SSHでPythonスクリプトを送信し実行できるかどうか |
| netconf | NETCONFで対象機器に接続できるかどうか |


<br>
<br>

[←演習5.1　Ansible Towerのセットアップ](/5.1-setup_Ansible_Tower.md)   
[↑目次に戻る](/README.md)

