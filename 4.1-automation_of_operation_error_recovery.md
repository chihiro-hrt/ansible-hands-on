[→目次に戻る](/README.md)
<br>
# 演習4.1　オペミスからの復旧自動化

演習3でSmartCS経由でALAXALA装置にAnsibleを介してオペレーションを行う方法の演習を行いました。
演習4では実運用でAnsibleとSmartCSをつかうユースケースの演習を行います。

演習4.1では監視対象のALAXALA装置に対して、オペレーションミスでIPリーチできなくなってしまった場合に  
SmartCSでコンフィグの復旧作業を行う演習となります。

## 目次
本演習では以下を行います。  
- STEP1.オペレーションミスを起こす（ALAXALA装置の設定を意図的に変更する
- STEP2.コンソール（SmartCS）経由で設定情報を取得する
- STEP3.コンソール（SmartCS）経由で設定を復旧させる


## 演習概要図

> あとで描く


### STEP1.オペレーションミスを起こす（ALAXALA装置の設定を意図的に変更する

※ひとまず暫定的に以下のPlaybook作成しました。もう少しいい内容に変更したいです。 
■Playbook例
```
  tasks:
  - name: "miss operation"
    ax_config:
      lines: shutdown
      parents: interface gigabitethernet 0/1 
      save_when: always
```
> ALAXALA様に要確認

■Playbook実行結果  
以下の通りエラーとなります。（途中のInterfaceがDownした為）
```
TASK [ax_config] ***************************************************************************
An exception occurred during task execution. To see the full traceback, use -vvv. The error was: ansible.module_utils.connection.ConnectionError: timeout value 30 seconds reached while trying to send command: b'shutdown'
＝＞
　shutdown コマンド送信したら、Timeout時間経過しても期待した実行結果を得られず、
  Playbookが終了してしまった、という内容のエラー。
```

Ansibleホストよりpingを実行しても、SSH接続を試みてもNGとなります。
```
$ ping 10.5.28.111
PING 10.5.28.111 (10.5.28.111) 56(84) bytes of data.
応答なし
^C
--- 10.5.28.111 ping statistics ---
10 packets transmitted, 0 received, 100% packet loss, time 8999ms

$ ssh alaxala@10.5.28.111
応答なし
^C
$ 
```

### STEP2.コンソール（SmartCS）経由で設定情報を取得する




[→演習4.2 通信障害からの復旧自動化](/4.2-automation_of_recovery_from_network_communication_failures.md)  
[←演習3.4　ALAXALA装置の設定情報をSmartCS経由で取得する](/3.4-setting_of_alaxala_device_via_smartcs.md)   
[↑目次に戻る](/README.md)
