[↑目次に戻る](/README.md)
<br>
# 演習3.4　ALAXALA装置の設定情報をSmartCS経由で取得する

## 目次
本演習では以下を行います。  
- STEP1.<code>ax_command</code>を使ってALAXALA装置の設定情報をSmartCS経由で取得する。  


## 演習概要図

> あとで描く

### STEP1. 演習3.1で作成したPlaybookを分割する。

演習3.3でax_commandを使ってALAXALA装置から設定情報を取得するPlaybookを作成しました。    
作成したPlaybookの内容を一部変更して、SmartCS経由（コンソール経由）で同様の情報を取得するPlaybookを作成します。

(1)Login用、Logout用のPlaybookを作成する。  
通常のモジュール(ax_command等)は、SSH経由で装置にログインして情報を取得しますが、コンソール経由で接続をする場合  
- コンソールからのログイン  
- コンソールからのログアウト  
の処理を行う必要があります。

演習3.1で作成したPlaybookと同様 コンソール経由でオペレーションした場合、以下のような入出力、Playbookとなります。  

ログイン時  
入出力
```
login: alaxala
Password: 

Copyright (c) 2012-2019 ALAXALA Networks Corporation. All rights reserved.

AX2230> 
```
Playbook
```
---
- name: '3-4 step1 login'
  hosts: NS2250
  
  vars:
  - ansible_connection: network_cli
  - ansible_network_os: smartcs
  
  tasks:
  - name: "smartcs_tty_command"
    smartcs_tty_command:
      tty: '1'
      recvchar:
      - 'login: '
      - 'Password: '
      - 'AX2230> '
      sendchar:
      - 'alaxala'
      - 'secret2230'
```

ログアウト時  
入出力  
```
AX2230> exit

login: 
```
Playbook
```
---
- name: '3-1 step2'
  hosts: NS2250
  
  vars:
  - ansible_connection: network_cli
  - ansible_network_os: smartcs
  
  tasks:
  - name: "smartcs_tty_command"
    smartcs_tty_command:
      tty: '1'
      recvchar:
      - 'login: '
      - 'AX2230> '
      sendchar:
      - 'exit'
      - 'exit'
```



(2)<code>ax_command</code>のhosts、vars 情報を変更する

説明文を記載  
Login用途  
Operation用途    
Logout用途
の3つPlaybookが必要な事を説明する。  
3つのPlaybookを１回で実行する為に、includeを使う部分を説明する。

### STEP2. ax_commandを使ってALAXALA装置の設定情報を取得をSmartCS経由で行う。

STEP1.で作成したPlaybookを実行する。

実行結果を演習3.3と比較するなどしてもいいかも


[→演習4.1 オペミスからの復旧自動化](/4.1-automation_of_operation_error_recovery.md)  
[→目次に戻る](/README.md)
