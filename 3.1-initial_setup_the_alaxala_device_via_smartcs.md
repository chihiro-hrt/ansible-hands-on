[→目次に戻る](/README.md)
<br>
# 演習3.1　ALAXALA装置にSmartCS経由で初期設定を行う

## 目次
本演習では以下を行います。 
- STEP1. smartcs_tty_command 使ったPlaybookを作成する
- STEP2. smartcs_tty_command を実行し、ALAXALA装置に初期設定を行う
- STEP3. ax_configを使い、SmartCS経由でALAXALA装置に初期設定を行うPlaybookを作成する
- STEP4. includeを使い、

## 演習概要図

### STEP1. smartcs_tty_command 使ったPlaybookを作成する

まずは、<code>smartcs_tty_command</code>を使ってPlaybookを作成を練習してみます。
ALAXALA装置にコンソール経由でログインして<code>show version</code>を実行するPlaybookを作成してみます。

実際のコンソールの入出力は以下のようなオペレーションとなります。
<br>
```
login: operator

Copyright (c) 2012-2019 ALAXALA Networks Corporation. All rights reserved.

> show version

Date 1980/04/09 00:42:51 UTC
Model: AX2230S-24T
S/W: OS-LT4 Ver. 2.10 (Build:01)
H/W: AX-2230-24T-B [CA022B24T000S0000C7S013:0]

> exit

login: 
```

<br>
これを<code>smartcs_tty_command</code>を使ってPlaybook化した場合、
以下のような内容となります。
<br>

```
---
- hosts: NS2250
  
  vars:
  - ansible_command_timeout: 60
  - ansible_connection: network_cli
  - ansible_network_os: smartcs
  - ansible_user: ansible
  - ansible_password: ansible
  
  tasks:
  - name: "Cisco Setup by Console"
    smartcs_tty_command:
      tty: 1
      nl : cr
      cmd_timeout : 5 
      recvchar : 
      - "Username: " 
      - "Password: " 
      sendchar : 
      - 'operator' 
      - 'show version' 
      - 'exit'
```
<br>
- Playbook作成途中、動作未確認
-- ALAXALAのユーザ、パスワードはきちんと付与する
-- varsもちゃんと考える

<code>smartcs_tty_command</code>は、上記のように入出力の文字列を<code>sendchar</code>、<code>recvchar</code>を使って制御するようなモジュールとなります。これを使う事で、SmartCSに接続されているネットワーク機器について、専用のモジュールが用意されていなくてもAnsible経由でのアクセスが可能となります。



### STEP2. smartcs_tty_command を実行し、ALAXALA装置に初期設定を行う

<code>smartcs_tty_command</code>を使ってALAXALA装置の初期構築を行うPlaybookを作成します。  
IP設定をコンソール経由で行う場合、以下のようなオペレーションとなります。
<br>
```
login: operator

Copyright (c) 2012-2019 ALAXALA Networks Corporation. All rights reserved.

> enable
# 
#
-->
実際にはID/Pass,enable pass もちゃんと設定する
設定内容は
- ip addr
- add user --> このユーザでこの後AXモジュールでログインする
- enable ssh 
- その他、必要なものがあれば
```
<br>

上記のコンソールオペレーションを<code>smartcs_tty_command</code>を使ってPlaybook化すると
以下のようなPlaybookとなります。
<br>
```
---
- hosts: NS2250
  
  vars:
  - ansible_command_timeout: 90
  - ansible_connection: network_cli
  - ansible_network_os: smartcs
  - ansible_user: ansible
  - ansible_password: ansible
  
  tasks:
  - name: "Cisco Setup by Console"
    smartcs_tty_command:
      tty: 4
      nl : cr
      cmd_timeout : 5 
      recvchar : 
      - "Username: " 
      - "Password: " 
      - "Catalyst3560>"
      - "Catalyst3560#"
      - "Catalyst3560(config)#"
      - "Catalyst3560(config-line)#"
      - "Catalyst3560(config-if)#"
      - "Press RETURN to get started."
      sendchar : 
      - __NL__
      - ssol
      - ssol
      - enable
      - enable
      - configure terminal
      - interface vlan 1
      - ip address 172.31.2.118 255.255.0.0
      - exit
      - exit
===> 
上記例はCisco
あとでALAXALA用に書き換える
```
<br>


### STEP3. ax_configを使い、SmartCS経由でALAXALA装置に初期設定を行うPlaybookを作成する




[→演習3.2 ALAXALA装置にSmartCS経由で追加設定を行う](/3.2-additional_setup_the_alaxala_device_via_smartcs.md)  
[→目次に戻る](/README.md)
